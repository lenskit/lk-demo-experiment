# This pipeline defines stages that control running and evaluating algorithms
# We define one stage per data set, using 'foreach' to iterate over the algorithms
# that we want to run on it.
#
# We can't really iterate over Cartesian products very easily in the DVC repetition
# system, so we do need to repeat a stage for each data set.
#
# You can make additional non-repeated stages to run one algorithm on one data set.
stages:
  run-explicit-model:
    matrix:
      data:
        - ml100k
        - mlsmall
        - ml1m
        - ml10m
        - ml20m
        - ml25m
      model:
        - Bias
        - IIE
        - UUE
        - ALS
    cmd: python run-model.py --splits data-split/${item.data} -o runs/${item.data}-${item.model} ${item.model}
    wdir: ..
    deps:
      - data-split/${item.data}
    outs:
      - runs/${item.data}-${item.model}

  run-implicit-model:
    matrix:
      data:
        - ml100k
        - mlsmall
        - ml1m
        - ml10m
        - ml20m
        - ml25m
      model:
        - Pop
        - III
        - IALS
    cmd: python run-model.py --splits data-split/${item.data} -o runs/${item.data}-${item.model} --no-predict ${item.model}
    wdir: ..
    deps:
      - data-split/${item.data}
    outs:
      - runs/${item.data}-${item.model}
